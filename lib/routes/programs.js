'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

var _express = require('express');

var _errorsJs = require('../errors.js');

var _models = require('../models');

var router = new _express.Router();

function getPrograms() {
  return _models.Program.list().map(function (program) {
    return program.data();
  });
}

router.get('/', function (req, res) {
  getPrograms().then(function (programs) {
    return res.json({
      status: 200,
      message: 'Listed programs',
      data: programs
    });
  });
});

router.param('program', function (req, res, next, id) {
  _models.Program.list().then(function (programs) {
    var program = programs[id];
    if (!program) {
      throw new _errorsJs.HttpError('Program ' + id + ' not found', 404, 'NotFound');
    }
    req.program = program;
    next();
  })['catch'](next);
});

router.get('/:program', function (req, res) {
  res.json({
    status: 200,
    message: 'Fetched program ' + req.program.name,
    data: req.program.data()
  });
});

router.post('/:program/run', function (req, res) {
  req.program.execute();
  getPrograms().then(function (programs) {
    return res.json({
      status: 200,
      message: 'Running program "' + req.program.name + '"',
      data: programs
    });
  });
});

exports['default'] = router;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi9yb3V0ZXMvcHJvZ3JhbXMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O3VCQUFxQixTQUFTOzt3QkFDTixjQUFjOztzQkFDaEIsV0FBVzs7QUFFakMsSUFBSSxNQUFNLEdBQUcsYUFKTCxNQUFNLEVBSVcsQ0FBQzs7QUFFMUIsU0FBUyxXQUFXLEdBQUc7QUFDckIsU0FBTyxRQUxELE9BQU8sQ0FLRSxJQUFJLEVBQUUsQ0FDbEIsR0FBRyxDQUFDLFVBQUEsT0FBTztXQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUU7R0FBQSxDQUFDLENBQUM7Q0FDbkM7O0FBRUQsTUFBTSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFLO0FBQzVCLGFBQVcsRUFBRSxDQUNWLElBQUksQ0FBQyxVQUFBLFFBQVE7V0FBSSxHQUFHLENBQUMsSUFBSSxDQUFDO0FBQ3pCLFlBQU0sRUFBRSxHQUFHO0FBQ1gsYUFBTyxFQUFFLGlCQUFpQjtBQUMxQixVQUFJLEVBQUUsUUFBUTtLQUNmLENBQUM7R0FBQSxDQUFDLENBQUM7Q0FDUCxDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUs7QUFDOUMsVUFuQk0sT0FBTyxDQW1CTCxJQUFJLEVBQUUsQ0FDWCxJQUFJLENBQUMsVUFBQSxRQUFRLEVBQUk7QUFDaEIsUUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQzNCLFFBQUksQ0FBQyxPQUFPLEVBQUU7QUFDWixZQUFNLGNBeEJOLFNBQVMsY0F3QnNCLEVBQUUsaUJBQWMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxDQUFDO0tBQ2pFO0FBQ0QsT0FBRyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7QUFDdEIsUUFBSSxFQUFFLENBQUM7R0FDUixDQUFDLFNBQ0ksQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUNoQixDQUFDLENBQUM7O0FBRUgsTUFBTSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEVBQUUsVUFBQyxHQUFHLEVBQUUsR0FBRyxFQUFLO0FBQ3BDLEtBQUcsQ0FBQyxJQUFJLENBQUM7QUFDUCxVQUFNLEVBQUUsR0FBRztBQUNYLFdBQU8sdUJBQXFCLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSTtBQUM1QyxRQUFJLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUU7R0FDekIsQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDOztBQUVILE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLFVBQUMsR0FBRyxFQUFFLEdBQUcsRUFBSztBQUN6QyxLQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDO0FBQ3RCLGFBQVcsRUFBRSxDQUNWLElBQUksQ0FBQyxVQUFBLFFBQVE7V0FBSSxHQUFHLENBQUMsSUFBSSxDQUFDO0FBQ3pCLFlBQU0sRUFBRSxHQUFHO0FBQ1gsYUFBTyx3QkFBc0IsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLE1BQUc7QUFDaEQsVUFBSSxFQUFFLFFBQVE7S0FDZixDQUFDO0dBQUEsQ0FBQyxDQUFDO0NBQ1AsQ0FBQyxDQUFDOztxQkFFWSxNQUFNIiwiZmlsZSI6ImxpYi9yb3V0ZXMvcHJvZ3JhbXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1JvdXRlcn0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQge0h0dHBFcnJvcn0gZnJvbSAnLi4vZXJyb3JzLmpzJztcbmltcG9ydCB7UHJvZ3JhbX0gZnJvbSAnLi4vbW9kZWxzJztcblxubGV0IHJvdXRlciA9IG5ldyBSb3V0ZXIoKTtcblxuZnVuY3Rpb24gZ2V0UHJvZ3JhbXMoKSB7XG4gIHJldHVybiBQcm9ncmFtLmxpc3QoKVxuICAgIC5tYXAocHJvZ3JhbSA9PiBwcm9ncmFtLmRhdGEoKSk7XG59XG5cbnJvdXRlci5nZXQoJy8nLCAocmVxLCByZXMpID0+IHtcbiAgZ2V0UHJvZ3JhbXMoKVxuICAgIC50aGVuKHByb2dyYW1zID0+IHJlcy5qc29uKHtcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAgbWVzc2FnZTogJ0xpc3RlZCBwcm9ncmFtcycsXG4gICAgICBkYXRhOiBwcm9ncmFtc1xuICAgIH0pKTtcbn0pO1xuXG5yb3V0ZXIucGFyYW0oJ3Byb2dyYW0nLCAocmVxLCByZXMsIG5leHQsIGlkKSA9PiB7XG4gIFByb2dyYW0ubGlzdCgpXG4gICAgLnRoZW4ocHJvZ3JhbXMgPT4ge1xuICAgICAgbGV0IHByb2dyYW0gPSBwcm9ncmFtc1tpZF07XG4gICAgICBpZiAoIXByb2dyYW0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEh0dHBFcnJvcihgUHJvZ3JhbSAke2lkfSBub3QgZm91bmRgLCA0MDQsICdOb3RGb3VuZCcpO1xuICAgICAgfVxuICAgICAgcmVxLnByb2dyYW0gPSBwcm9ncmFtO1xuICAgICAgbmV4dCgpO1xuICAgIH0pXG4gICAgLmNhdGNoKG5leHQpO1xufSk7XG5cbnJvdXRlci5nZXQoJy86cHJvZ3JhbScsIChyZXEsIHJlcykgPT4ge1xuICByZXMuanNvbih7XG4gICAgc3RhdHVzOiAyMDAsXG4gICAgbWVzc2FnZTogYEZldGNoZWQgcHJvZ3JhbSAke3JlcS5wcm9ncmFtLm5hbWV9YCxcbiAgICBkYXRhOiByZXEucHJvZ3JhbS5kYXRhKClcbiAgfSk7XG59KTtcblxucm91dGVyLnBvc3QoJy86cHJvZ3JhbS9ydW4nLCAocmVxLCByZXMpID0+IHtcbiAgcmVxLnByb2dyYW0uZXhlY3V0ZSgpO1xuICBnZXRQcm9ncmFtcygpXG4gICAgLnRoZW4ocHJvZ3JhbXMgPT4gcmVzLmpzb24oe1xuICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICBtZXNzYWdlOiBgUnVubmluZyBwcm9ncmFtIFwiJHtyZXEucHJvZ3JhbS5uYW1lfVwiYCxcbiAgICAgIGRhdGE6IHByb2dyYW1zXG4gICAgfSkpO1xufSk7XG5cbmV4cG9ydCBkZWZhdWx0IHJvdXRlcjtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==